name: ğŸ” PR ì²´í¬

on:
  pull_request:
    branches: [main]
    types: [opened, synchronize, reopened]

jobs:
  lint-check:
    name: ğŸ” ë¦°íŠ¸ ì²´í¬
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 'lts/*'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run package lint
        run: npm run lint

      - name: Install test dependencies
        run: |
          cd test
          npm install

      - name: Run ESLint tests
        run: |
          cd test
          npm run lint

  package-check:
    name: ğŸ“¦ íŒ¨í‚¤ì§€ ì²´í¬
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 'lts/*'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Check package structure
        run: |
          echo "ğŸ” Checking package exports..."
          node -e "
            const pkg = require('./package.json');
            console.log('ğŸ“„ Package name:', pkg.name);
            console.log('ğŸ“„ Package version:', pkg.version);
            console.log('ğŸ“„ Exports:', Object.keys(pkg.exports || {}));
          "

      - name: Verify package imports
        run: |
          echo "ğŸ§ª Testing package imports..."
          node -e "
            try {
              const base = require('./src/base.mjs');
              const typescript = require('./src/typescript.mjs'); 
              const react = require('./src/react.mjs');
              const prettier = require('./src/prettier.mjs');
              const hansanghyeon = require('./src/hansanghyeon.mjs');
              console.log('âœ… All package exports can be imported');
            } catch (e) {
              console.error('âŒ Import failed:', e.message);
              process.exit(1);
            }
          "

  pr-comment:
    name: ğŸ’¬ PR ì½”ë©˜íŠ¸
    runs-on: ubuntu-latest
    needs: [lint-check, package-check]
    if: always()
    steps:
      - name: Comment PR
        uses: actions/github-script@v7
        with:
          script: |
            const lintStatus = '${{ needs.lint-check.result }}';
            const packageStatus = '${{ needs.package-check.result }}';
            
            let comment = '## ğŸ” PR ì²´í¬ ê²°ê³¼\n\n';
            comment += `- ğŸ” ë¦°íŠ¸ ì²´í¬: ${lintStatus === 'success' ? 'âœ… í†µê³¼' : 'âŒ ì‹¤íŒ¨'}\n`;
            comment += `- ğŸ“¦ íŒ¨í‚¤ì§€ ì²´í¬: ${packageStatus === 'success' ? 'âœ… í†µê³¼' : 'âŒ ì‹¤íŒ¨'}\n\n`;
            
            if (lintStatus === 'success' && packageStatus === 'success') {
              comment += 'ğŸ‰ ëª¨ë“  ì²´í¬ê°€ í†µê³¼í–ˆìŠµë‹ˆë‹¤! ë¨¸ì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
            } else {
              comment += 'âš ï¸ ì¼ë¶€ ì²´í¬ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ì • í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
            }
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });